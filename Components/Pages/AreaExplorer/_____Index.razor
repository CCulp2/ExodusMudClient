@page "/AreaExplorer"
@using Ganss.Xss
@using ExodusMudClient.Data.Game.Models
@using ExodusMudClient.Utility;
@inject ITcpService TcpService
@inject IAreaFileConverter AreaConverter
@inject IWebHostEnvironment _environment
@inject IJSRuntime JSRuntime;

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="@("mt-7")">
    @if (selectedArea == null)
    {
        <____AreaList Areas="areas" OnAreaSelected="HandleAreaSelected"></____AreaList>
    }

    <___Area selectedArea="selectedArea" OnAreaClosed="HandleAreaClosed"></___Area>
</MudContainer>


@code {
    // binded attributes
    public bool areasExpanded = true;
    public AreaFile? selectedArea { get; set; }
    public AreaFileMobile? selectedMobile = null;
    public List<AreaFile> areas = new List<AreaFile>();

    protected override void OnInitialized()
    {
        areas = AreaConverter.GetAreaList(Path.Combine(_environment.WebRootPath, "AreaFiles"));
    }

    private void HandleAreaSelected(AreaFile? area)
    {
        var areaFilepath = Path.Combine(_environment.WebRootPath, "AreaFiles", area.FileName);
        selectedArea = AreaConverter.ParseAreaFile(areaFilepath);
        StateHasChanged();
    }

    private void HandleAreaClosed()
    {
        selectedArea = null;
        StateHasChanged();
    }

}
